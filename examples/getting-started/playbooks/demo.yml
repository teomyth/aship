---
- name: Aship Demo Playbook
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
    # Info tag tasks - Display application information
    - name: Welcome message
      debug:
        msg: |
          üéâ Welcome to aship Getting Started Demo!

          This playbook demonstrates aship's core features:
          ‚úì Variable collection and validation
          ‚úì Tag-based task execution
          ‚úì Clear output and feedback
      tags: [info]

    - name: Display collected variables
      debug:
        msg: |
          üìã Variables collected by aship:

          Application Settings:
          ‚Ä¢ App Name: {{ app_name }}
          ‚Ä¢ Environment: {{ app_environment }}
          ‚Ä¢ Port: {{ app_port }}
          ‚Ä¢ SSL Enabled: {{ enable_ssl }}

          Services & Frameworks:
          ‚Ä¢ Services: {{ services | join(', ') }}
          ‚Ä¢ Frameworks: {{ frameworks | join(', ') }}

          Security:
          ‚Ä¢ Admin Password: {{ '***MASKED***' if admin_password else 'not set' }}
      tags: [info]

    # Setup tag tasks - Environment setup
    - name: Environment setup
      debug:
        msg: |
          üîß Setting up {{ app_environment }} environment for {{ app_name }}

          Configuration:
          ‚Ä¢ Creating application directory: /opt/{{ app_name }}
          ‚Ä¢ Configuring port: {{ app_port }}
          ‚Ä¢ SSL mode: {{ 'enabled' if enable_ssl else 'disabled' }}
      tags: [setup]

    - name: Service configuration
      debug:
        msg: |
          ‚öôÔ∏è Configuring services: {{ services | join(', ') }}

          Each service will be configured with:
          ‚Ä¢ Environment: {{ app_environment }}
          ‚Ä¢ Port range: {{ app_port }}-{{ app_port + services|length }}
          ‚Ä¢ SSL: {{ 'enabled' if enable_ssl else 'disabled' }}
      tags: [setup]

    # Deploy tag tasks - Application deployment
    - name: Framework setup
      debug:
        msg: |
          üöÄ Setting up frameworks: {{ frameworks | join(', ') }}

          Framework-specific configurations:
          {% for framework in frameworks %}
          ‚Ä¢ {{ framework }}: configured for {{ app_environment }}
          {% endfor %}
      tags: [deploy]

    - name: Application deployment
      debug:
        msg: |
          üì¶ Deploying {{ app_name }} to {{ app_environment }}

          Deployment details:
          ‚Ä¢ Target: {{ ansible_hostname | default('localhost') }}
          ‚Ä¢ Services: {{ services | length }} service(s)
          ‚Ä¢ Frameworks: {{ frameworks | length }} framework(s)
          ‚Ä¢ Access URL: {{ 'https' if enable_ssl else 'http' }}://localhost:{{ app_port }}
      tags: [deploy]

    # Test tag tasks - Application testing
    - name: Connection test
      debug:
        msg: |
          üß™ Testing application connectivity

          Test results:
          ‚Ä¢ Port {{ app_port }}: ‚úì Available
          ‚Ä¢ SSL check: {{ '‚úì Configured' if enable_ssl else '‚ö† Disabled' }}
          ‚Ä¢ Services: {{ services | length }}/{{ services | length }} ready
      tags: [test]

    - name: Final status
      debug:
        msg: |
          ‚úÖ Demo completed successfully!

          Summary:
          ‚Ä¢ Application: {{ app_name }}
          ‚Ä¢ Environment: {{ app_environment }}
          ‚Ä¢ Status: Ready
          ‚Ä¢ Access: {{ 'https' if enable_ssl else 'http' }}://localhost:{{ app_port }}

          Selected tags executed: {{ ansible_run_tags | default(['all']) | join(', ') }}
      tags: [info, setup, deploy, test]
